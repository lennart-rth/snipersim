Bootstrap: docker
From: ubuntu:24.04

%labels
    Author ${USER}
    Version 1.0
    Description Ubuntu 24.04 base with Sniper + RISC-V build dependencies, Python3, and numpy

%environment
    # Default runtime environment variables
    export DEBIAN_FRONTEND=noninteractive
    export TZ=${TZ_ARG:-UTC}

%post
    bash -c '
        set -euo pipefail

        # Configure timezone (default UTC if not set)
        if [ -z "${TZ_ARG:-}" ]; then
            TZ_ARG=UTC
        fi
        echo "Configuring timezone: ${TZ_ARG}"
        echo "${TZ_ARG}" > /etc/timezone || true
        ln -sf /usr/share/zoneinfo/${TZ_ARG} /etc/localtime || true

        # Update package lists and install system packages
        apt-get update
        apt-get install -y --no-install-recommends \
            tzdata \
            python3 \
            python3-dev \
            python3-venv \
            python3-pip \
            python3-numpy \
            screen \
            tmux \
            binutils \
            automake \
            build-essential \
            cmake \
            curl \
            wget \
            libboost-dev \
            libsqlite3-dev \
            zlib1g-dev \
            libbz2-dev \
            libdb++-dev \
            autoconf \
            autotools-dev \
            bc \
            bison \
            device-tree-compiler \
            flex \
            gawk \
            gperf \
            libexpat-dev \
            libgmp-dev \
            libmpc-dev \
            libmpfr-dev \
            libtool \
            libusb-1.0-0-dev \
            patchutils \
            pkg-config \
            texinfo \
            gdb \
            gfortran \
            git \
            g++ \
            vim \
        && apt-get clean \
        && rm -rf /var/lib/apt/lists/*

        # Optional workspace directory
        mkdir -p /workspace
        chown -R 1000:1000 /workspace 2>/dev/null || true
    '

%runscript
    exec /bin/bash "$@"

%help
    ---------------------------------------------------------------
    Ubuntu 24.04 base image with Sniper simulator and RISC-V build dependencies.
    Includes: Python3, numpy, GNU build chain, CMake, Boost, SQLite, and developer tools.
    ---------------------------------------------------------------
    Usage:
      apptainer exec <image>.sif bash
    Build-time timezone override:
      export SINGULARITYENV_TZ_ARG="Europe/Zurich"
      apptainer build --fakeroot ubuntu-24.04-sniper-<user>.sif Singularity-ubuntu-24.04.def
    ---------------------------------------------------------------

